/*! swipe-lc - v1.1.0 - 2020-05-13 */
function Swipe(t){this.id=t.id,this.cas=document.getElementById(this.id),this.context=this.cas.getContext("2d"),this._w=t._w,this._h=t._h,this.radius=t.radius,this.posX=0,this.posY=0,this.isMouseDown=!1,this.coverType=t.coverType,this.mask=t.mask,this.percent=t.percent,this.callback=t.callback,this.init(),this.addEvent()}Swipe.prototype.init=function(){var t,e;"color"===this.coverType&&(this.context.fillStyle=this.mask,this.context.fillRect(0,0,this._w,this._h),this.context.globalCompositeOperation="destination-out"),"img"===this.coverType&&(t=this,(e=new Image).src=this.mask,e.onload=function(){t.context.drawImage(this,0,0,this.width,this.height,0,0,t._w,t._h),t.context.globalCompositeOperation="destination-out"})},Swipe.prototype.addEvent=function(){this.device=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(navigator.userAgent.toLowerCase()),this.clickEvent=this.device?"touchstart":"mousedown",this.moveEvent=this.device?"touchmove":"mousemove",this.endEvent=this.device?"touchend":"mouseup";var o=this;this.cas.addEventListener(this.clickEvent,function(t){var e=t||window.event;o.posX=this.device?e.touches[0].clientX-o.getAllOffset(o.cas).allLeft:e.clientX-o.getAllOffset(o.cas).allLeft,o.posY=this.device?e.touches[0].clientY-o.getAllOffset(o.cas).allTop:e.clientY-o.getAllOffset(o.cas).allTop,o.drawArc(o.posX,o.posY),o.isMouseDown=!0,console.log(o.getAllOffset(o.cas).allTop)}),this.cas.addEventListener(this.moveEvent,function(t){if(!o.isMouseDown)return!1;var e=t||window.event,i=this.device?e.touches[0].clientX-o.getAllOffset(o.cas).allLeft:e.clientX-o.getAllOffset(o.cas).allLeft,s=this.device?e.touches[0].clientY-o.getAllOffset(o.cas).allTop:e.clientY-o.getAllOffset(o.cas).allTop;o.drawLine(o.posX,o.posY,i,s),o.posX=i,o.posY=s}),this.cas.addEventListener(this.endEvent,function(t){o.isMouseDown=!1;var e=o.getPercent();o.callback.call(null,e),e>o.percent&&o.context.clearRect(0,0,o._w,o._h)})},Swipe.prototype.drawArc=function(t,e){this.context.save(),this.context.beginPath(),this.context.arc(t,e,this.radius,0,2*Math.PI),this.context.fillStyle="red",this.context.fill(),this.context.stroke(),this.context.restore()},Swipe.prototype.drawLine=function(t,e,i,s){this.context.save(),this.context.beginPath(),this.context.moveTo(t,e),this.context.lineTo(i,s),this.context.lineWidth=2*this.radius,this.context.lineCap="round",this.context.strokeStyle="rgb(255,125,40)",this.context.stroke(),this.context.restore()},Swipe.prototype.getPercent=function(){for(var t=0,e=this.context.getImageData(0,0,this._w,this._h),i=0;i<e.data.length;i+=4)0===e.data[i+3]&&t++;var s=t/(this._w*this._h)*100;return console.log("透明点占总面积的百分比："+s.toFixed(2)+"%"),s},Swipe.prototype.getAllOffset=function(t){for(var e=0,i=0;t;)e+=t.offsetTop+t.clientTop,i+=t.offsetLeft+t.clientLeft,t=t.offsetParent;return{allTop:e,allLeft:i}};